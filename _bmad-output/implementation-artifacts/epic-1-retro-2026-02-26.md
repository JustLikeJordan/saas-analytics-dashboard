# Epic 1 Retrospective — Project Foundation & User Authentication

**Date:** 2026-02-26
**Facilitator:** Bob (Scrum Master)
**Participants:** Alice (Product Owner), Charlie (Senior Dev), Dana (QA Engineer), Corey (Project Lead)

---

## Epic Summary

- **Stories completed:** 6/6 (100%)
- **Test growth:** 0 → 26 → 79 → 101 → 120 → 124
- **Code review rounds:** 5 (Stories 1.1–1.5 in prior sessions, 1.6 today)
- **Code review findings trend:** 23 → 0 → 7 → 0 → 3 → 3 (declining — team got sharper)
- **Technical debt carried forward:** 2 items (Docker verification, integer IDs on analytics_events)
- **Production incidents:** 0

---

## Successes

1. **Architecture patterns held across all 6 stories with zero rework.** BFF proxy, barrel exports, error hierarchy (`AppError` + 5 subclasses), `createTestApp()` factory — all established in Story 1.1 and used unchanged through 1.6. Story 1.5's invite system slotted into the existing `protectedRouter` and test infrastructure cleanly.

2. **Code review findings dropped steadily.** Story 1.1 had 7 HIGH + 8 MEDIUM + 8 LOW. By Story 1.6, reviews found 3 focused issues (migration journal, type safety, CI explicitness). The team learned from each round.

3. **Test coverage grew without regressions.** 124 tests across 15 files. Each story added coverage; nothing broke. The `createTestApp()` helper from Story 1.4 made route testing repeatable.

4. **Story dev notes improved iteratively.** "Previous Story Intelligence" sections became the most valuable documentation pattern — calling out stale shared dist, ESM `.js` extensions, strict mode gotchas, and migration patterns before they caused problems.

5. **Shared constants + type derivation pattern.** `ANALYTICS_EVENTS as const` → `AnalyticsEventName` union type gave compile-time enforcement of valid event names. Same pattern worked for `ROLES` and `AUTH` constants.

---

## Challenges

1. **Stale `packages/shared/dist/`** — caused 8 phantom test failures in Story 1.3. The fix is always `pnpm --filter shared build`, but it's easy to forget when the shared source changes but dist doesn't auto-rebuild in dev mode.

2. **Custom Drizzle migration journal gap.** Migration 0004 (RLS for analytics_events + org_invites) existed on disk but was missing from `_journal.json`. The migration runner would have silently skipped it. Code review caught it; automation didn't.

3. **ESLint wasn't configured until Story 1.6.** Stories 1.2–1.5 ran without lint checks. Story 1.2 notes explicitly flagged the gap ("lint: pre-existing failure") but it was deferred for four stories.

4. **Docker compose-up never verified end-to-end.** Story 1.1 validated `docker compose config` and all TypeScript type-checks, but Docker Desktop macOS networking prevented actual image pulls. The acceptance criterion "first-run 100% success" remains unverified.

5. **ESM `.js` extension requirement.** Every API import needs the `.js` suffix. Documented in every story's dev notes. Never caused a shipped bug, but persistent cognitive overhead.

---

## Key Insights

1. **Code review is the safety net for things CI can't catch yet.** Migration journal entries, type safety gaps at module boundaries, implicit CI behavior — these are human-judgment issues. Automate what you can, but don't skip the review.

2. **Story dev notes compound in value.** Each story taught the next one. The "Previous Story Intelligence" pattern should be mandatory in every story file going forward.

3. **Foundation epics produce more findings by nature.** The declining code review curve is healthy — early stories establish patterns, later stories follow them.

4. **Verify infrastructure where you find it.** Docker was configured correctly but never run. That gap persisted for 6 stories. Fix infrastructure issues in the story where they're discovered.

---

## Action Items

### Process Improvements

| # | Action | Owner | Success Criteria |
|---|--------|-------|-----------------|
| 1 | Add "migration journal checklist" to story dev notes for any story creating custom SQL migrations | Scrum Master (story creation) | Every story touching `drizzle/migrations/` includes: "Verify custom migration has `_journal.json` entry" |
| 2 | Verify shared build runs before lint/type-check in CI | Dev | Turborepo `dependsOn: ["^build"]` catches stale dist; verify in CI logs |
| 3 | Continue "Previous Story Intelligence" sections in every story | Scrum Master (story creation) | Every story includes gotchas, file dependencies, and patterns from prior stories |

### Technical Debt

| # | Item | Owner | Priority |
|---|------|-------|----------|
| 1 | Docker compose-up end-to-end verification | Dev (folded into Story 2.1) | High — prerequisite for seed data |
| 2 | `shared` package missing `vitest` dep — `pnpm test` fails at root | Dev | Low — no shared tests yet |

### Team Agreements

- Fix infrastructure gaps (lint, tooling) in the story where they're discovered, not deferred
- Custom Drizzle migrations always get a manual journal entry check before marking done
- Story dev notes are a first-class deliverable, not an afterthought

---

## Epic 2 Readiness

**Assessment:** Ready, with Docker verification as Story 2.1 prerequisite.

| Area | Status |
|------|--------|
| Testing & Quality | 124 tests, lint clean, type-check clean |
| Deployment | Not deployed — Docker verification pending |
| Technical Health | Solid — patterns established, no fragile areas |
| Unresolved Blockers | Docker compose-up (folded into Story 2.1) |

**Dependencies Epic 2 has on Epic 1:**
- DB schema + Drizzle migration pipeline
- Auth + RBAC middleware (protectedRouter, roleGuard)
- `trackEvent()` analytics service
- BFF proxy pattern for new routes
- Shared constants + Zod schemas pattern

**No significant discoveries requiring Epic 2 plan changes.** The architecture and story breakdown remain sound.

---

## Next Steps

1. Create Story 2.1 (Seed Data & Demo Mode Foundation) — Docker verification is first task
2. Carry forward "Previous Story Intelligence" pattern
3. Add migration journal checklist to stories with custom SQL migrations
4. Review these action items when Story 2.1 is created
